// Generated by CoffeeScript 1.6.3
jQuery.sap.require("sap.ui.demo.myFiori.util.Formatter");

jQuery.sap.require("sap.ui.demo.myFiori.util.Grouper");

sap.ui.controller("sap.ui.demo.myFiori.view.Master", {
  onExit: function() {
    if (this._lineItemViewDialog) {
      this._lineItemViewDialog.destroy();
      return this._lineItemViewDialog = null;
    }
  },
  handleListItemPress: function(evt) {
    var context;
    context = evt.getSource().getBindingContext();
    return this.nav.to("Detail", context);
  },
  handleSearch: function(evt) {
    var binding, filter, filters, list, query;
    filters = [];
    query = evt.getParameter("query");
    if (query && query.length > 0) {
      filter = new sap.ui.model.Filter("SoId", sap.ui.model.FilterOperator.Contains, query);
      filters.push(filter);
    }
    list = this.getView().byId("list");
    binding = list.getBinding("items");
    return binding.filter(filters);
  },
  handleListSelect: function(evt) {
    var context;
    context = evt.getParameter("listItem").getBindingContext();
    return this.nav.to("Detail", context);
  },
  handleViewSettings: function(evt) {
    var that;
    that = this;
    if (!this._lineItemViewDialog) {
      this._lineItemViewDialog = new sap.m.ViewSettingsDialog({
        groupItems: [
          new sap.m.ViewSettingsItem({
            text: "Price",
            key: "GrossAmount"
          }), new sap.m.ViewSettingsItem({
            text: "Status",
            key: "BillingStatus"
          })
        ],
        confirm: function(evt) {
          var aSorters, bDescending, mParams, oBinding, sPath, vGroup;
          aSorters = [];
          mParams = evt.getParameters();
          if (mParams.groupItem) {
            sPath = mParams.groupItem.getKey();
            bDescending = mParams.groupDescending;
            vGroup = sap.ui.demo.myFiori.util.Grouper[sPath];
            aSorters.push(new sap.ui.model.Sorter(sPath, bDescending, vGroup));
          }
          oBinding = that.getView().byId("list").getBinding("items");
          return oBinding.sort(aSorters);
        }
      });
    }
    return this._lineItemViewDialog.open();
  }
});
